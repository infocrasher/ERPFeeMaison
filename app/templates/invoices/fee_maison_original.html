<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Facture {{ invoice.number }}</title>
<style>
  @page { 
    size: A4; 
    margin: 12mm; 
    @bottom-center {
      content: "Page " counter(page) " sur " counter(pages);
      font-size: 9px;
      color: #666;
    }
  }
  
  :root {
    --primary: #2E4057;      /* Bleu marine - tes couleurs actuelles */
    --accent: #D4AF37;       /* Or - tes couleurs actuelles */
    --secondary: #5A6C7D;    /* Gris bleu */
    --text: #111;
    --muted: #666;
    --border: #ddd;
    --light-bg: #f8f9fa;
  }
  
  * { 
    box-sizing: border-box; 
    margin: 0;
    padding: 0;
  }
  
  body { 
    font-family: 'DejaVu Sans', Arial, sans-serif; 
    color: var(--text); 
    font-size: 11px; 
    line-height: 1.4;
  }
  
  /* En-tête avec logo et infos entreprise */
  .header {
    display: flex; 
    justify-content: space-between; 
    align-items: flex-start; 
    margin-bottom: 8mm; 
    padding-bottom: 6mm; 
    border-bottom: 3px solid var(--accent);
  }
  
  .company-info {
    display: flex; 
    align-items: center; 
    gap: 15px;
  }
  
  .logo {
    flex-shrink: 0;
  }
  
  .logo img { 
    height: 65px; 
    width: auto;
  }
  
  .company-details h1 { 
    margin: 0 0 5px 0; 
    font-size: 20px; 
    font-weight: bold;
    letter-spacing: 1px; 
    text-transform: uppercase; 
    color: var(--primary); 
  }
  
  .company-details .subtitle {
    font-size: 12px;
    color: var(--secondary);
    font-style: italic;
    margin-bottom: 8px;
  }
  
  .company-address {
    font-size: 10px;
    color: var(--muted);
    line-height: 1.3;
  }
  
  /* Bloc facture à droite */
  .invoice-header {
    text-align: right;
    border: 2px solid var(--primary);
    border-radius: 8px;
    padding: 12px 15px;
    background: linear-gradient(135deg, #fff, var(--light-bg));
    min-width: 150px;
  }
  
  .invoice-title {
    margin: 0 0 8px 0; 
    font-size: 18px; 
    font-weight: bold;
    text-transform: uppercase; 
    letter-spacing: 1px; 
    color: var(--accent);
    border-bottom: 1px solid var(--accent);
    padding-bottom: 4px;
  }
  
  .invoice-meta {
    font-size: 10px;
  }
  
  .invoice-meta .label {
    font-weight: bold;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .invoice-meta .value {
    margin-left: 5px;
  }
  
  /* Section client et infos */
  .client-section {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6mm;
    gap: 20px;
  }
  
  .client-box {
    flex: 1;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 12px;
    background: #fff;
  }
  
  .client-box .label {
    font-weight: bold;
    color: var(--primary);
    text-transform: uppercase;
    font-size: 10px;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
    border-bottom: 1px solid var(--accent);
    padding-bottom: 2px;
  }
  
  .client-details {
    font-size: 11px;
    line-height: 1.4;
  }
  
  .client-details strong {
    color: var(--primary);
    font-size: 12px;
  }
  
  /* Tableau des articles */
  .items-section {
    margin-bottom: 6mm;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    border: 2px solid var(--primary);
    border-radius: 6px;
    overflow: hidden;
  }
  
  thead th {
    background: var(--primary);
    color: white;
    text-align: center;
    font-weight: bold;
    padding: 10px 8px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  tbody td {
    padding: 10px 8px;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
  }
  
  tbody tr:nth-child(even) {
    background: var(--light-bg);
  }
  
  tbody tr:hover {
    background: #e8f4f8;
  }
  
  .text-center { text-align: center; }
  .text-right { text-align: right; }
  .text-left { text-align: left; }
  
  .designation-col {
    font-weight: 500;
    color: var(--text);
  }
  
  .amount-col {
    font-weight: bold;
    color: var(--primary);
  }
  
  /* Section totaux */
  .totals-section {
    display: flex;
    justify-content: flex-end;
    margin-top: 6mm;
  }
  
  .totals-box {
    min-width: 250px;
    border: 2px solid var(--primary);
    border-radius: 8px;
    padding: 12px 15px;
    background: linear-gradient(135deg, #fff, var(--light-bg));
  }
  
  .total-line {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    font-size: 11px;
  }
  
  .total-line.final {
    border-top: 2px solid var(--accent);
    margin-top: 6px;
    padding-top: 8px;
    font-weight: bold;
    font-size: 12px;
    color: var(--primary);
  }
  
  .total-label {
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .total-value {
    font-weight: bold;
    color: var(--primary);
  }
  
  /* Section montant en lettres */
  .amount-words {
    margin: 6mm 0;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 12px;
    background: var(--light-bg);
    font-size: 11px;
    text-align: center;
  }
  
  .amount-words .label {
    font-weight: bold;
    color: var(--primary);
    margin-bottom: 4px;
  }
  
  .amount-words .words {
    font-style: italic;
    color: var(--text);
  }
  
  /* Section notes */
  .notes-section {
    margin: 6mm 0;
    border-left: 4px solid var(--accent);
    padding-left: 12px;
  }
  
  .notes-title {
    font-weight: bold;
    color: var(--primary);
    text-transform: uppercase;
    font-size: 10px;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
  }
  
  .notes-content {
    font-size: 10px;
    color: var(--muted);
    line-height: 1.4;
  }
  
  /* Remerciements */
  .thanks {
    margin: 8mm 0 6mm 0;
    text-align: center;
    font-size: 12px;
    font-weight: bold;
    color: var(--accent);
    border-top: 1px solid var(--border);
    padding-top: 6mm;
  }
  
  /* Pied de page avec infos légales */
  .footer {
    margin-top: 6mm;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 2px solid var(--primary);
    padding-top: 6mm;
    font-size: 9px;
    color: var(--muted);
  }
  
  .footer-left, .footer-center, .footer-right {
    flex: 1;
    text-align: center;
  }
  
  .footer-left {
    text-align: left;
  }
  
  .footer-right {
    text-align: right;
  }
  
  .footer .legal-info {
    font-weight: bold;
    color: var(--primary);
  }
  
  /* Responsive adjustments */
  @media print {
    body { 
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
  }
</style>
</head>
<body>

  <!-- En-tête avec logo et titre facture -->
  <header class="header">
    <div class="company-info">
      {% if invoice.seller.logo_url %}
      <div class="logo">
        <img src="{{ invoice.seller.logo_url }}" alt="Logo Fée Maison">
      </div>
      {% endif %}
      <div class="company-details">
        <h1>{{ invoice.seller.name }}</h1>
        <div class="subtitle">Restaurant • Traiteur • Pâtisserie</div>
        <div class="company-address">
          {% for line in invoice.seller.address_lines %}
            {{ line }}<br>
          {% endfor %}
          TEL : {{ invoice.seller.tel }}<br>
          EMAIL : {{ invoice.seller.email }}
        </div>
      </div>
    </div>

    <div class="invoice-header">
      <h2 class="invoice-title">
        {% if invoice.type == 'proforma' %}Facture Proforma{% else %}Facture{% endif %}
      </h2>
      <div class="invoice-meta">
        <div><span class="label">N°</span><span class="value">{{ invoice.number }}</span></div>
        <div><span class="label">Date</span><span class="value">{{ invoice.date|date_fr }}</span></div>
        {% if invoice.due_date %}
        <div><span class="label">Échéance</span><span class="value">{{ invoice.due_date|date_fr }}</span></div>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Section client -->
  <section class="client-section">
    <div class="client-box">
      <div class="label">Facturé à</div>
      <div class="client-details">
        <strong>{{ invoice.buyer.name }}</strong><br>
        {% for line in invoice.buyer.address_lines %}
          {{ line }}<br>
        {% endfor %}
        {% if invoice.buyer.contact %}Contact : {{ invoice.buyer.contact }}<br>{% endif %}
        {% if invoice.buyer.phone %}Tél : {{ invoice.buyer.phone|format_phone }}<br>{% endif %}
        {% if invoice.buyer.email %}Email : {{ invoice.buyer.email }}<br>{% endif %}
        {% if invoice.buyer.tax_number %}NIF : {{ invoice.buyer.tax_number }}{% endif %}
      </div>
    </div>
    
    <div class="client-box">
      <div class="label">Modalités</div>
      <div class="client-details">
        <strong>Paiement :</strong> {{ invoice.payment_mode }}<br>
        <strong>Conditions :</strong> 30 jours<br>
        <strong>Régime TVA :</strong> Non assujetti<br>
        <strong>Activité :</strong> Restauration
      </div>
    </div>
  </section>

  <!-- Tableau des articles -->
  <section class="items-section">
    <table>
      <thead>
        <tr>
          <th style="width: 50%;">DÉSIGNATION</th>
          <th style="width: 12%;">QTÉ</th>
          <th style="width: 19%;">PRIX UNIT. HT</th>
          <th style="width: 19%;">MONTANT HT</th>
        </tr>
      </thead>
      <tbody>
        {% for line in invoice.lines %}
        <tr>
          <td class="text-left designation-col">{{ line.designation }}</td>
          <td class="text-center">{{ line.qty|int }}</td>
          <td class="text-right">{{ line.unit_price|dzd }}</td>
          <td class="text-right amount-col">{{ line.amount|dzd }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- Totaux -->
  <section class="totals-section">
    <div class="totals-box">
      <div class="total-line">
        <span class="total-label">Sous-total HT :</span>
        <span class="total-value">{{ total_ht|dzd }} {{ invoice.currency }}</span>
      </div>
      <div class="total-line">
        <span class="total-label">TVA :</span>
        <span class="total-value">Non assujetti</span>
      </div>
      <div class="total-line final">
        <span class="total-label">TOTAL :</span>
        <span class="total-value">{{ total_ht|dzd }} {{ invoice.currency }}</span>
      </div>
    </div>
  </section>

  <!-- Montant en lettres -->
  <section class="amount-words">
    <div class="label">Arrêté la présente facture à la somme de :</div>
    <div class="words">
      {{ total_ht|lettres_dzd|capitalize_first }}.
    </div>
  </section>

  <!-- Notes si présentes -->
  {% if invoice.notes %}
  <section class="notes-section">
    <div class="notes-title">Notes :</div>
    <div class="notes-content">{{ invoice.notes }}</div>
  </section>
  {% endif %}

  <!-- Remerciements -->
  <div class="thanks">
    ✨ Merci de Votre Confiance ✨
  </div>

  <!-- Pied de page avec informations légales -->
  <footer class="footer">
    <div class="footer-left">
      <div><strong>TEL :</strong> {{ invoice.seller.tel }}</div>
      <div><strong>EMAIL :</strong> {{ invoice.seller.email }}</div>
    </div>
    
    <div class="footer-center">
      <div class="legal-info">{{ invoice.seller.name }}</div>
      <div>Restaurant • Traiteur • Pâtisserie</div>
    </div>
    
    <div class="footer-right">
      <div><strong>NIF :</strong> {{ invoice.seller.nif }}</div>
      <div><strong>RC :</strong> {{ invoice.seller.rc }}</div>
    </div>
  </footer>

</body>
</html>
